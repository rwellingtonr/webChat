<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
      integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/style.css" />
    <title>Web Chat</title>
  </head>
  <body>
    <div class="join-container">
      <header class="join-header">
        <h1>Chat Teste Websocket</h1>
      </header>
      <main class="join-main">
        <form action="chat.html">
          <div class="form-control">
            <label for="user">Usu√°rio</label>
            <input
              type="text"
              name="user"
              id="user"
              placeholder="Seu nome..."
              required
            />
          </div>
          <div class="form-control">
            <label for="roomId">Salas</label>
            <select name="roomId" id="roomId">
              <option value="js">JavaScript</option>
            </select>
          </div>
          <button type="submit" class="btn">Entrar no chat</button>
        </form>
      </main>
      <script
        src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"
        integrity="sha512-zN6KYOtONNTOGXz0RkWX2EpavN9VdIs+2w+To+fhciFv83YA9maUpi2lzZWrOfKXdFIZZomWufBznkyHi3a8oQ=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
      ></script>

      <script>
        const socket = io("http://localhost:3000")

        const list = {}

        socket.on("new_room", (data) => {
          const { roomId } = data
          if (!(roomId in list)) {
            list = { ...list, roomId }
            console.log(list)
            newElement(roomId)
          }
          socket.emit("front-msg", { roomId })
        })

        function newElement(roomId) {
          var li = document.createElement("option")
          var inputValue = roomId
          var t = document.createTextNode(inputValue)
          li.appendChild(t)
          if (inputValue === "") {
            alert("You must write something!")
          } else {
            document.getElementById("roomId").appendChild(li)
          }

          for (i = 0; i < close.length; i++) {
            close[i].onclick = function () {
              var div = this.parentElement
              div.style.display = "none"
            }
          }
        }
      </script>
    </div>
  </body>
</html>
